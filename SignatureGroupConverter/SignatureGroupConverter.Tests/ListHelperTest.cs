using System;
using System.Collections.Generic;
using System.Linq;
using NUnit.Framework;
using SignatureGroupConverter.Core;

namespace Migrate.Tests
{
    [TestFixture]
    public class ListHelperTest
    {

        /// <summary>
        /// Helper method to check, that expected and actual result lists are the same
        /// </summary>
        /// <param name="expectedResults"></param>
        /// <param name="results"></param>
        private static void AssertResult(List<List<string>> expectedResults, List<List<string>> results)
        {
            for (var cnt = 0; cnt < expectedResults.Count; cnt++)
            {
                if (results.Count < cnt + 1)
                    Assert.Fail("Result too few elements");

                var result = results.ElementAt(cnt);
                var expectedResult = expectedResults.ElementAt(cnt);
                if (result.Intersect(expectedResult).Count() != expectedResult.Count)
                    Assert.Fail(
                        $"Expected: {expectedResult.Aggregate((i, j) => i + "," + j)}, actual result: {result.Aggregate((i, j) => i + "," + j)}");
            }
            if (results.Count > expectedResults.Count)
                Assert.Fail("Result too many elements");
        }

        [Test]
        public void ListIntersect_SingleSigGroup()
        {
            var allLists = new List<List<string>>
            {
                new List<string> { "A" }
            };
            var expectedResult = new List<List<string>>
            {
                new List<string> { "A"}
            };
            var result = ListHelper.TransformPartnerItemListToPartnerGroupList(allLists);
            AssertResult(expectedResult, result);
        }

        [Test]
        public void ListIntersect_TwoGroups_Distinct()
        {
            var allLists = new List<List<string>>
            {
                new List<string> { "A" },
                new List<string> { "B" }
            };
            var expectedResult = new List<List<string>>
            {
                new List<string> { "A"},
                new List<string> { "B"}
            };
            var result = ListHelper.TransformPartnerItemListToPartnerGroupList(allLists);
            AssertResult(expectedResult, result);
        }

        [Test]
        public void ListIntersect_TwoGroups_Intersect()
        {
            var allLists = new List<List<string>>
            {
                new List<string> { "A","B" },
                new List<string> { "A","B","C" }
            };
            var expectedResult = new List<List<string>>
            {
                new List<string> { "C"},
                new List<string> { "A","B"}
            };
            var result = ListHelper.TransformPartnerItemListToPartnerGroupList(allLists);
            AssertResult(expectedResult, result);
        }

        [Test]
        public void ListIntersect_ThreeGroups()
        {
            var allLists = new List<List<string>>
            {
                new List<string> { "A","B","C","D","E","F" },
                new List<string> { "A","E","G" },
                new List<string> { "F" }
            };
            var expectedResult = new List<List<string>>
            {
                new List<string> { "F" },
                new List<string> { "G"},
                new List<string> { "A","E"},
                new List<string> { "B","C","D"}
            };
            var result = ListHelper.TransformPartnerItemListToPartnerGroupList(allLists);
            AssertResult(expectedResult, result);
        }

        [Test]
        public void ListIntersect_ComplexRealWordExample()
        {
            var allLists = new List<List<string>>
            {
                new List<string> {"2007121307830003","2007121307830004","2007121807830000","2007121907830000","2007122007830000","2007122707830001","2007123107830000","2007123107830001","2008010707830000","2008011107830001","2008011607830000","2008011607830001","2008012207830000","2008012807830000"},
                new List<string> {"2007111307830015","2007111307830016","2007111307830017"},
                new List<string> {"2007111307830015","2007111307830016","2007111307830017"},
                new List<string> {"2007110807830012"},
                new List<string> {"2007041207830084","2007041207830098","2007041207830133","2007041207830134","2007041207830136","2007041207830143","2007041207830146","2007041207830153","2007041207830174","2007041207830175","2007041207830180","2007041207830181","2007041207830182","2007070407830215","2007070407830216","2007070407830217","2007070407830218","2007070407830222","2007070407830223","2007070407830224","2007071307830000","2007090407830007"},
                new List<string> {"2007122707830002","2008011107830001","2008012207830000"},
                new List<string> {"2007041207830078","2007041207830079","2007041207830080","2007041207830081","2007041207830082","2007041207830083","2007041207830084","2007041207830085","2007041207830086","2007041207830087","2007041207830088","2007041207830089","2007041207830090","2007041207830091","2007041207830092","2007041207830093","2007041207830094","2007041207830095","2007041207830096","2007041207830097","2007041207830098","2007041207830099","2007041207830100","2007041207830101","2007041207830102","2007041207830103","2007041207830104","2007041207830105","2007041207830106","2007041207830107","2007041207830108","2007041207830109","2007041207830110","2007041207830111","2007041207830112","2007041207830113","2007041207830114","2007041207830115","2007041207830116","2007041207830117","2007041207830118","2007041207830119","2007041207830120","2007041207830121","2007041207830122","2007041207830123","2007041207830124","2007041207830125","2007041207830126","2007041207830127","2007041207830128","2007041207830129","2007041207830130","2007041207830131","2007041207830132","2007041207830133","2007041207830134","2007041207830135","2007041207830136","2007041207830137","2007041207830138","2007041207830139","2007041207830140","2007041207830141","2007041207830142","2007041207830143","2007041207830144","2007041207830145","2007041207830146","2007041207830148","2007041207830149","2007041207830150","2007041207830151","2007041207830152","2007041207830153","2007041207830154","2007041207830155","2007041207830156","2007041207830157","2007041207830158","2007041207830159","2007041207830160","2007041207830161","2007041207830162","2007041207830163","2007041207830164","2007041207830165","2007041207830166","2007041207830167","2007041207830168","2007041207830169","2007041207830170","2007041207830171","2007041207830172","2007041207830173","2007041207830174","2007041207830175","2007041207830176","2007041207830177","2007041207830178","2007041207830179","2007041207830180","2007041207830181","2007041207830182","2007041207830183","2007041207830184","2007041207830185","2007041207830186","2007041207830187","2007041207830188","2007041207830189","2007041207830190","2007041207830191","2007041207830192","2007041207830193","2007041207830194","2007041207830195","2007041207830196","2007041207830197","2007041207830198","2007041207830199","2007041207830200","2007041207830201","2007041207830202","2007041207830203","2007041207830204","2007041207830205","2007041207830206","2007041207830207","2007041207830208","2007041207830209","2007041207830210","2007041207830211","2007041207830212","2007041207830213","2007070407830215","2007070407830216","2007070407830217","2007070407830218","2007070407830219","2007070407830220","2007070407830221","2007070407830222","2007070407830223","2007070407830224","2007070407830225","2007070407830226","2007070407830227","2007070407830228","2007070407830229","2007070407830230","2007070407830231","2007070407830232","2007070407830233","2007070507830234","2007070507830235","2007070607830236","2007070607830237","2007070907830238","2007070907830239","2007071007830000","2007071007830001","2007071007830002","2007071107830003","2007071107830004","2007071207830000","2007071307830000","2007071307830001","2007071607830002","2007071807830003","2007072407830004","2007073007830000","2007073107830000","2007073107830001","2007080307830002","2007080607830003","2007082007830004","2007082307830005","2007082707830006","2007090407830007","2007090707830008","2007090707830009","2007091007830010","2007091707830047","2007091707830048","2007091807830000","2007092007830001","2007092407830002","2007092507830003","2007092707830004"},
                new List<string> {"2007091207830011","2007091207830012","2007091207830013","2007091207830014","2007091207830015","2007091207830016","2007091207830017","2007091207830018","2007091207830019","2007091207830020","2007091207830021","2007091207830022","2007091207830023","2007091207830024","2007091207830025","2007091207830026","2007091207830027","2007091207830028","2007091207830029","2007091207830030","2007091207830031","2007091207830032","2007091207830033","2007091207830034","2007091207830035","2007091207830036","2007091207830037","2007091207830038","2007091207830039","2007091207830040","2007091207830041","2007091207830042","2007091207830043","2007091207830044","2007091207830045","2007091207830046"},
                new List<string> {"2007091207830011","2007091207830012","2007091207830013","2007091207830014","2007091207830015","2007091207830016","2007091207830017","2007091207830018","2007091207830019","2007091207830020","2007091207830021","2007091207830022","2007091207830023","2007091207830024","2007091207830025","2007091207830026","2007091207830027","2007091207830028","2007091207830029","2007091207830030","2007091207830031","2007091207830032","2007091207830033","2007091207830034","2007091207830035","2007091207830036","2007091207830037","2007091207830038","2007091207830039","2007091207830040","2007091207830041","2007091207830042","2007091207830043","2007091207830044","2007091207830045","2007091207830046"},
                new List<string> {"2007122707830002","2008011107830001","2008012207830000"},
                new List<string> {"2007092807830005","2007100107830006","2007100107830007","2007100407830000","2007100807830001","2007100907830002","2007101107830003","2007101507830004","2007101807830005","2007101807830006","2007102207830007","2007102207830008","2007102307830009","2007102307830010","2007102307830011"},
                new List<string> {"2007092807830005","2007100107830006","2007100107830007","2007100407830000","2007100807830001","2007100907830002","2007101107830003","2007101507830004","2007101807830005","2007101807830006","2007102207830007","2007102207830008","2007102307830009","2007102307830010","2007102307830011"},
                new List<string> {"2007110807830012","2007110907830013","2007110907830014","2007111407830018","2007111907830000","2007112007830000"},
                new List<string> {"2007110807830012","2007110907830013","2007110907830014","2007111407830018","2007111907830000","2007112007830000"},
                new List<string> {"2007110807830012"},
                new List<string> {"2007121307830003","2007121307830004","2007121807830000","2007121907830000","2007122007830000","2007122707830001","2007123107830000","2007123107830001","2008010707830000","2008011107830001","2008011607830000","2008011607830001","2008012207830000","2008012807830000"},
                new List<string> {"2007112107830000","2007112207830000","2007112307830000","2007112907830000","2007112907830001","2007120707830000","2007120707830001","2007120707830002","2007121007830000","2007121007830001","2007121007830002"},
                new List<string> {"2007041207830084","2007041207830098","2007041207830133","2007041207830134","2007041207830136","2007041207830143","2007041207830146","2007041207830153","2007041207830174","2007041207830175","2007041207830180","2007041207830181","2007041207830182","2007070407830215","2007070407830216","2007070407830217","2007070407830218","2007070407830222","2007070407830223","2007070407830224","2007071307830000","2007090407830007"},
                new List<string> {"2007091207830011","2007091207830012","2007091207830013","2007091207830014","2007091207830015","2007091207830016","2007091207830017","2007091207830018","2007091207830019","2007091207830020","2007091207830021","2007091207830022","2007091207830023","2007091207830024","2007091207830025","2007091207830026","2007091207830027","2007091207830028","2007091207830029","2007091207830030","2007091207830031","2007091207830032","2007091207830033","2007091207830034","2007091207830035","2007091207830036","2007091207830037","2007091207830038","2007091207830039","2007091207830040","2007091207830041","2007091207830042","2007091207830043","2007091207830044","2007091207830045","2007091207830046"},
                new List<string> {"2007041207830078","2007041207830079","2007041207830080","2007041207830081","2007041207830082","2007041207830083","2007041207830084","2007041207830085","2007041207830086","2007041207830087","2007041207830088","2007041207830089","2007041207830090","2007041207830091","2007041207830092","2007041207830093","2007041207830094","2007041207830095","2007041207830096","2007041207830097","2007041207830098","2007041207830099","2007041207830100","2007041207830101","2007041207830102","2007041207830103","2007041207830104","2007041207830105","2007041207830106","2007041207830107","2007041207830108","2007041207830109","2007041207830110","2007041207830111","2007041207830112","2007041207830113","2007041207830114","2007041207830115","2007041207830116","2007041207830117","2007041207830118","2007041207830119","2007041207830120","2007041207830121","2007041207830122","2007041207830123","2007041207830124","2007041207830125","2007041207830126","2007041207830127","2007041207830128","2007041207830129","2007041207830130","2007041207830131","2007041207830132","2007041207830133","2007041207830134","2007041207830135","2007041207830136","2007041207830137","2007041207830138","2007041207830139","2007041207830140","2007041207830141","2007041207830142","2007041207830143","2007041207830144","2007041207830145","2007041207830146","2007041207830148","2007041207830149","2007041207830150","2007041207830151","2007041207830152","2007041207830153","2007041207830154","2007041207830155","2007041207830156","2007041207830157","2007041207830158","2007041207830159","2007041207830160","2007041207830161","2007041207830162","2007041207830163","2007041207830164","2007041207830165","2007041207830166","2007041207830167","2007041207830168","2007041207830169","2007041207830170","2007041207830171","2007041207830172","2007041207830173","2007041207830174","2007041207830175","2007041207830176","2007041207830177","2007041207830178","2007041207830179","2007041207830180","2007041207830181","2007041207830182","2007041207830183","2007041207830184","2007041207830185","2007041207830186","2007041207830187","2007041207830188","2007041207830189","2007041207830190","2007041207830191","2007041207830192","2007041207830193","2007041207830194","2007041207830195","2007041207830196","2007041207830197","2007041207830198","2007041207830199","2007041207830200","2007041207830201","2007041207830202","2007041207830203","2007041207830204","2007041207830205","2007041207830206","2007041207830207","2007041207830208","2007041207830209","2007041207830210","2007041207830211","2007041207830212","2007041207830213","2007070407830215","2007070407830216","2007070407830217","2007070407830218","2007070407830219","2007070407830220","2007070407830221","2007070407830222","2007070407830223","2007070407830224","2007070407830225","2007070407830226","2007070407830227","2007070407830228","2007070407830229","2007070407830230","2007070407830231","2007070407830232","2007070407830233","2007070507830234","2007070507830235","2007070607830236","2007070607830237","2007070907830238","2007070907830239","2007071007830000","2007071007830001","2007071007830002","2007071107830003","2007071107830004","2007071207830000","2007071307830000","2007071307830001","2007071607830002","2007071807830003","2007072407830004","2007073007830000","2007073107830000","2007073107830001","2007080307830002","2007080607830003","2007082007830004","2007082307830005","2007082707830006","2007090407830007","2007090707830008","2007090707830009","2007091007830010","2007091707830047","2007091707830048","2007091807830000","2007092007830001","2007092407830002","2007092507830003","2007092707830004"},
                new List<string> {"2007111307830015","2007111307830016","2007111307830017"},
                new List<string> {"2007121307830003","2007121307830004","2007121807830000","2007121907830000","2007122007830000","2007122707830001","2007123107830000","2007123107830001","2008010707830000","2008011107830001","2008011607830000","2008011607830001","2008012207830000","2008012807830000"},
                new List<string> {"2007112107830000","2007112207830000","2007112307830000","2007112907830000","2007112907830001","2007120707830000","2007120707830001","2007120707830002","2007121007830000","2007121007830001","2007121007830002"},
                new List<string> {"2007041207830084","2007041207830098","2007041207830133","2007041207830134","2007041207830136","2007041207830143","2007041207830146","2007041207830153","2007041207830174","2007041207830175","2007041207830180","2007041207830181","2007041207830182","2007070407830215","2007070407830216","2007070407830217","2007070407830218","2007070407830222","2007070407830223","2007070407830224","2007071307830000","2007090407830007"},
                new List<string> {"2007110807830012","2007110907830013","2007110907830014","2007111407830018","2007111907830000","2007112007830000"},
                new List<string> {"2007112107830000","2007112207830000","2007112307830000","2007112907830000","2007112907830001","2007120707830000","2007120707830001","2007120707830002","2007121007830000","2007121007830001","2007121007830002"},
                new List<string> {"2007110807830012"},
                new List<string> {"2007041207830078","2007041207830079","2007041207830080","2007041207830081","2007041207830082","2007041207830083","2007041207830084","2007041207830085","2007041207830086","2007041207830087","2007041207830088","2007041207830089","2007041207830090","2007041207830091","2007041207830092","2007041207830093","2007041207830094","2007041207830095","2007041207830096","2007041207830097","2007041207830098","2007041207830099","2007041207830100","2007041207830101","2007041207830102","2007041207830103","2007041207830104","2007041207830105","2007041207830106","2007041207830107","2007041207830108","2007041207830109","2007041207830110","2007041207830111","2007041207830112","2007041207830113","2007041207830114","2007041207830115","2007041207830116","2007041207830117","2007041207830118","2007041207830119","2007041207830120","2007041207830121","2007041207830122","2007041207830123","2007041207830124","2007041207830125","2007041207830126","2007041207830127","2007041207830128","2007041207830129","2007041207830130","2007041207830131","2007041207830132","2007041207830133","2007041207830134","2007041207830135","2007041207830136","2007041207830137","2007041207830138","2007041207830139","2007041207830140","2007041207830141","2007041207830142","2007041207830143","2007041207830144","2007041207830145","2007041207830146","2007041207830148","2007041207830149","2007041207830150","2007041207830151","2007041207830152","2007041207830153","2007041207830154","2007041207830155","2007041207830156","2007041207830157","2007041207830158","2007041207830159","2007041207830160","2007041207830161","2007041207830162","2007041207830163","2007041207830164","2007041207830165","2007041207830166","2007041207830167","2007041207830168","2007041207830169","2007041207830170","2007041207830171","2007041207830172","2007041207830173","2007041207830174","2007041207830175","2007041207830176","2007041207830177","2007041207830178","2007041207830179","2007041207830180","2007041207830181","2007041207830182","2007041207830183","2007041207830184","2007041207830185","2007041207830186","2007041207830187","2007041207830188","2007041207830189","2007041207830190","2007041207830191","2007041207830192","2007041207830193","2007041207830194","2007041207830195","2007041207830196","2007041207830197","2007041207830198","2007041207830199","2007041207830200","2007041207830201","2007041207830202","2007041207830203","2007041207830204","2007041207830205","2007041207830206","2007041207830207","2007041207830208","2007041207830209","2007041207830210","2007041207830211","2007041207830212","2007041207830213","2007070407830215","2007070407830216","2007070407830217","2007070407830218","2007070407830219","2007070407830220","2007070407830221","2007070407830222","2007070407830223","2007070407830224","2007070407830225","2007070407830226","2007070407830227","2007070407830228","2007070407830229","2007070407830230","2007070407830231","2007070407830232","2007070407830233","2007070507830234","2007070507830235","2007070607830236","2007070607830237","2007070907830238","2007070907830239","2007071007830000","2007071007830001","2007071007830002","2007071107830003","2007071107830004","2007071207830000","2007071307830000","2007071307830001","2007071607830002","2007071807830003","2007072407830004","2007073007830000","2007073107830000","2007073107830001","2007080307830002","2007080607830003","2007082007830004","2007082307830005","2007082707830006","2007090407830007","2007090707830008","2007090707830009","2007091007830010","2007091707830047","2007091707830048","2007091807830000","2007092007830001","2007092407830002","2007092507830003","2007092707830004"},
                new List<string> {"2007092807830005","2007100107830006","2007100107830007","2007100407830000","2007100807830001","2007100907830002","2007101107830003","2007101507830004","2007101807830005","2007101807830006","2007102207830007","2007102207830008","2007102307830009","2007102307830010","2007102307830011"},
                new List<string> {"2007122707830002","2008011107830001","2008012207830000"}
            };
            var expectedResult = new List<List<string>>
            {
                new List<string> {"2007110807830012"},
                new List<string> {"2007122707830002"},
                new List<string> {"2008011107830001","2008012207830000"},
                new List<string> {"2007111307830015","2007111307830016","2007111307830017"},
                new List<string> {"2007110907830013","2007110907830014","2007111407830018","2007111907830000","2007112007830000"},
                new List<string> {"2007112107830000","2007112207830000","2007112307830000","2007112907830000","2007112907830001","2007120707830000","2007120707830001","2007120707830002","2007121007830000","2007121007830001","2007121007830002"},
                new List<string> {"2007121307830003","2007121307830004","2007121807830000","2007121907830000","2007122007830000","2007122707830001","2007123107830000","2007123107830001","2008010707830000","2008011607830000","2008011607830001","2008012807830000"},
                new List<string> {"2007092807830005","2007100107830006","2007100107830007","2007100407830000","2007100807830001","2007100907830002","2007101107830003","2007101507830004","2007101807830005","2007101807830006","2007102207830007","2007102207830008","2007102307830009","2007102307830010","2007102307830011"},
                new List<string> {"2007041207830084","2007041207830098","2007041207830133","2007041207830134","2007041207830136","2007041207830143","2007041207830146","2007041207830153","2007041207830174","2007041207830175","2007041207830180","2007041207830181","2007041207830182","2007070407830215","2007070407830216","2007070407830217","2007070407830218","2007070407830222","2007070407830223","2007070407830224","2007071307830000","2007090407830007"},
                new List<string> {"2007091207830011","2007091207830012","2007091207830013","2007091207830014","2007091207830015","2007091207830016","2007091207830017","2007091207830018","2007091207830019","2007091207830020","2007091207830021","2007091207830022","2007091207830023","2007091207830024","2007091207830025","2007091207830026","2007091207830027","2007091207830028","2007091207830029","2007091207830030","2007091207830031","2007091207830032","2007091207830033","2007091207830034","2007091207830035","2007091207830036","2007091207830037","2007091207830038","2007091207830039","2007091207830040","2007091207830041","2007091207830042","2007091207830043","2007091207830044","2007091207830045","2007091207830046"},
                new List<string> {"2007041207830078","2007041207830079","2007041207830080","2007041207830081","2007041207830082","2007041207830083","2007041207830085","2007041207830086","2007041207830087","2007041207830088","2007041207830089","2007041207830090","2007041207830091","2007041207830092","2007041207830093","2007041207830094","2007041207830095","2007041207830096","2007041207830097","2007041207830099","2007041207830100","2007041207830101","2007041207830102","2007041207830103","2007041207830104","2007041207830105","2007041207830106","2007041207830107","2007041207830108","2007041207830109","2007041207830110","2007041207830111","2007041207830112","2007041207830113","2007041207830114","2007041207830115","2007041207830116","2007041207830117","2007041207830118","2007041207830119","2007041207830120","2007041207830121","2007041207830122","2007041207830123","2007041207830124","2007041207830125","2007041207830126","2007041207830127","2007041207830128","2007041207830129","2007041207830130","2007041207830131","2007041207830132","2007041207830135","2007041207830137","2007041207830138","2007041207830139","2007041207830140","2007041207830141","2007041207830142","2007041207830144","2007041207830145","2007041207830148","2007041207830149","2007041207830150","2007041207830151","2007041207830152","2007041207830154","2007041207830155","2007041207830156","2007041207830157","2007041207830158","2007041207830159","2007041207830160","2007041207830161","2007041207830162","2007041207830163","2007041207830164","2007041207830165","2007041207830166","2007041207830167","2007041207830168","2007041207830169","2007041207830170","2007041207830171","2007041207830172","2007041207830173","2007041207830176","2007041207830177","2007041207830178","2007041207830179","2007041207830183","2007041207830184","2007041207830185","2007041207830186","2007041207830187","2007041207830188","2007041207830189","2007041207830190","2007041207830191","2007041207830192","2007041207830193","2007041207830194","2007041207830195","2007041207830196","2007041207830197","2007041207830198","2007041207830199","2007041207830200","2007041207830201","2007041207830202","2007041207830203","2007041207830204","2007041207830205","2007041207830206","2007041207830207","2007041207830208","2007041207830209","2007041207830210","2007041207830211","2007041207830212","2007041207830213","2007070407830219","2007070407830220","2007070407830221","2007070407830225","2007070407830226","2007070407830227","2007070407830228","2007070407830229","2007070407830230","2007070407830231","2007070407830232","2007070407830233","2007070507830234","2007070507830235","2007070607830236","2007070607830237","2007070907830238","2007070907830239","2007071007830000","2007071007830001","2007071007830002","2007071107830003","2007071107830004","2007071207830000","2007071307830001","2007071607830002","2007071807830003","2007072407830004","2007073007830000","2007073107830000","2007073107830001","2007080307830002","2007080607830003","2007082007830004","2007082307830005","2007082707830006","2007090707830008","2007090707830009","2007091007830010","2007091707830047","2007091707830048","2007091807830000","2007092007830001","2007092407830002","2007092507830003","2007092707830004"}
            };
            var result = ListHelper.TransformPartnerItemListToPartnerGroupList(allLists);
            AssertResult(expectedResult, result);
        }

    }
}
